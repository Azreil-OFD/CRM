import{defineComponent as e,ref as t,inject as n,computed as r,resolveComponent as o,openBlock as a,createElementBlock as i,createVNode as s,normalizeClass as l,withCtx as c,createBlock as u,createCommentVNode as d,createTextVNode as p,toDisplayString as h}from"vue";import{useRouter as f}from"vue-router";import{useStores as v,useApi as y}from"@directus/extensions-sdk";import{useI18n as m}from"vue-i18n";var g=(0).constructor,b=g.isFinite;g.isInteger;var w=[].constructor.isArray;function x(e){return null!==e&&"object"==typeof e}function E(e,t){return void 0===t&&(t=0),"string"==typeof e&&e.length>=t}function T(e){return b(e)}function S(e){return w(e)}function k(e,t){return x(e)&&t in e}var N=new(function(){function e(e){this.size=e,this.reset()}return e.prototype.reset=function(){this.oldestIndex=0,this.map={},this.cachedKeys=new Array(this.size)},e.prototype.get=function(e){return this.map[e]},e.prototype.set=function(e,t){this.map[e]=t;var n=this.cachedKeys[this.oldestIndex];void 0!==n&&delete this.map[n],this.cachedKeys[this.oldestIndex]=e,this.oldestIndex++,this.oldestIndex%=this.size},e}())(1e3);function A(e){var t=e.charAt(0),n=e.substr(-1);if("'\"`".includes(t)||"'\"`".includes(n)){if(e.length<2||t!==n)throw new SyntaxError('Mismatching string quotation: "'+e+'"');return e.substring(1,e.length-1)}if(e.includes("["))throw new SyntaxError('Missing ] in varName "'+e+'"');return"+"===t?e.substr(1):e}function P(e,t,n){var r=t.trim();if(""===r)return e;if(r.startsWith(".")){if(!n)throw new SyntaxError('Unexpected . at the start of "'+t+'"');if(""===(r=r.substr(1).trim()))return e}else if(n)throw new SyntaxError('Missing . at the start of "'+t+'"');if(r.endsWith("."))throw new SyntaxError('Unexpected "." at the end of "'+t+'"');for(var o=0,a=r.split(".");o<a.length;o++){var i=a[o].trim();if(""===i)throw new SyntaxError('Empty prop name when parsing "'+t+'"');e.push(i)}return e}function $(e){if(!E(e))throw new TypeError("Cannot parse path. Expected string. Got a "+typeof e);for(var t,n,r=0,o=!1,a=new Array(0),i=0;i<e.length&&-1!==(t=e.indexOf("[",i));i=r){if(-1===(r=e.indexOf("]",t)))throw new SyntaxError('Missing ] in varName "'+e+'"');if(0===(n=e.substring(t+1,r).trim()).length)throw new SyntaxError("Unexpected token ]");r++,P(a,e.substring(i,t),o),a.push(A(n)),o=!0}return P(a,e.substring(r),o)}function G(e,t,n){if(void 0===n&&(n={}),!x(n))throw new TypeError("get expects an object option. Got "+typeof n);var r=n.depth,o=void 0===r?10:r;if(!T(o)||o<=0)throw new RangeError("Expected a positive number for depth. Got "+o);var a=Array.isArray(t)?t:$.cached(t),i=function(){return a.join(" > ")};if(a.length>o)throw new ReferenceError("The path cannot be deeper than "+o+' levels. Got "'+i()+'"');for(var s=e,l=0,c=a;l<c.length;l++){var u=c[l];if(!k(s,u)){if(n.propsExist)throw new ReferenceError(u+' is not defined in the scope at path: "'+i()+'"');return}s=s[u]}return s}$.cached=function(e){var t=N.get(e);return void 0===t&&(t=$(e),N.set(e,t)),t};var O=function(){function e(e,t){var n=this;if(void 0===t&&(t={}),this.tokens=e,this.options=t,this.render=function(e){void 0===e&&(e={});var t=n.tokens.varNames.length;n.cacheParsedPaths();for(var r=new Array(t),o=0;o<t;o++)r[o]=G(e,n.toPathCache[o],n.options);return n.stringify(r)},this.renderFn=function(e,t){void 0===t&&(t={});var r=n.resolveVarNames(e,t);return n.stringify(r)},this.renderFnAsync=function(e,t){return void 0===t&&(t={}),Promise.all(n.resolveVarNames(e,t)).then((function(e){return n.stringify(e)}))},!x(e)||!S(e.strings)||!S(e.varNames)||e.strings.length!==e.varNames.length+1)throw new TypeError("Invalid tokens object");if(!x(t))throw new TypeError("Options should be an object. Got a "+typeof t);t.validateVarNames&&this.cacheParsedPaths()}return e.prototype.cacheParsedPaths=function(){var e=this.tokens.varNames;if(void 0===this.toPathCache){this.toPathCache=new Array(e.length);for(var t=0;t<e.length;t++)this.toPathCache[t]=$.cached(e[t])}},e.prototype.resolveVarNames=function(e,t){void 0===t&&(t={});var n=this.tokens.varNames;if("function"!=typeof e)throw new TypeError("Expected a resolver function. Got "+String(e));for(var r=n.length,o=new Array(r),a=0;a<r;a++)o[a]=e.call(null,n[a],t);return o},e.prototype.stringify=function(e){for(var t=this.tokens.strings,n=this.options.explicit,r=e.length,o="",a=0;a<r;a++){o+=t[a];var i=e[a];(n||null!=i)&&(o+=i)}return o+=t[r]},e}();function j(e,t){void 0===t&&(t={});var n=function(e,t){if(void 0===t&&(t={}),!E(e))throw new TypeError("The template parameter must be a string. Got a "+typeof e);if(!x(t))throw new TypeError("Options should be an object. Got a "+typeof t);var n=t.tags,r=void 0===n?["{{","}}"]:n,o=t.maxVarNameLength,a=void 0===o?1e3:o;if(!S(r)||2!==r.length)throw TypeError("tags should be an array of two elements. Got "+String(r));var i=r[0],s=r[1];if(!E(i,1)||!E(s,1)||i===s)throw new TypeError('The open and close symbols should be two distinct non-empty strings. Got "'+i+'" and "'+s+'"');if(!T(a)||a<=0)throw new Error("Expected a positive number for maxVarNameLength. Got "+a);for(var l,c,u=i.length,d=s.length,p=0,h=[],f=[],v=0;v<e.length&&-1!==(l=e.indexOf(i,v));){var y=l+u;if(-1===(p=e.substr(y,a+d).indexOf(s)))throw new SyntaxError('Missing "'+s+'" in the template for the "'+i+'" at position '+l+" within "+a+" characters");if(p+=y,0===(c=e.substring(y,p).trim()).length)throw new SyntaxError('Unexpected "'+s+'" tag found at position '+l);if(c.includes(i))throw new SyntaxError('Variable names cannot have "'+i+'". But at position '+l+'. Got "'+c+'"');f.push(c),p+=d,h.push(e.substring(v,l)),v=p}return h.push(e.substring(p)),{strings:h,varNames:f}}(e,t);return new O(n,t)}function C(e,t,n){return j(e,n).render(t)}var _=e({emits:["input"],props:{label:{type:String,default:null},buttonType:{type:String,default:null},value:{type:Boolean,default:null},icon:{type:String,default:null},url:{type:String,default:null},method:{type:String,default:"patch"},body:{type:Object,default:null},disabled:{type:Boolean,default:!1},collection:{type:String,required:!0},result:{type:String},headers:{type:Array},primaryKey:{type:[String,Number],required:!0}},setup(e){const{useNotificationsStore:o}=v(),a=o(),i=f(),s=y(),l=t(!1),c=n("values"),{t:u}=m();return{isLoading:l,label:r((()=>C(e.label,c.value))),async click(){l.value=!0;try{const t=c.value;console.log(t);const n=C(e.url,t)||`/items/${e.collection}/${e.primaryKey}`,r=function(e){try{return JSON.parse(e)}catch(t){return e}}(C(e.body,t)),o=e.method||"patch",u=Object.fromEntries(e.headers.map((({key:e,value:n})=>[e,C(n,t)])));console.log({method:o,url:n,data:r,headers:u});const d=await s.request({method:o,url:n,data:r,headers:u});"list"===e.result?i.push(`/content/${e.collection}`):a.add({title:d.title||"Success",text:d.text||"Action was completed successfully",type:"success",dialog:!0})}catch(e){console.warn(e);const t=e.response?.data?.errors?.[0]?.extensions?.code||e.extensions?.code||"UNKNOWN",n=e.response?.data?.errors?.[0]?.message||e.message||void 0;a.add({title:u(`errors.${t}`),text:n,type:"error",dialog:!0,error:e})}finally{l.value=!1}}}}});var I=[],L=[];!function(e,t){if(e&&"undefined"!=typeof document){var n,r=!0===t.prepend?"prepend":"append",o=!0===t.singleTag,a="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(o){var i=I.indexOf(a);-1===i&&(i=I.push(a)-1,L[i]={}),n=L[i]&&L[i][r]?L[i][r]:L[i][r]=s()}else n=s();65279===e.charCodeAt(0)&&(e=e.substring(1)),n.styleSheet?n.styleSheet.cssText+=e:n.appendChild(document.createTextNode(e))}function s(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var n=Object.keys(t.attributes),o=0;o<n.length;o++)e.setAttribute(n[o],t.attributes[n[o]]);var i="prepend"===r?"afterbegin":"beforeend";return a.insertAdjacentElement(i,e),e}}("\n.info[data-v-64969d30] {\n    --v-button-background-color: var(--blue);\n    --v-button-background-color-hover: var(--blue-125);\n    --v-button-color: var(--blue-alt);\n    --v-button-color-hover: var(--blue-alt);\n}\n.success[data-v-64969d30] {\n    --v-button-background-color: var(--success);\n    --v-button-background-color-hover: var(--success-125);\n    --v-button-color: var(--success-alt);\n    --v-button-color-hover: var(--success-alt);\n}\n.warning[data-v-64969d30] {\n    --v-button-background-color: var(--warning);\n    --v-button-background-color-hover: var(--warning-125);\n    --v-button-color: var(--warning-alt);\n    --v-button-color-hover: var(--warning-alt);\n}\n.danger[data-v-64969d30] {\n    --v-button-icon-color: var(--white);\n    --v-button-background-color: var(--danger);\n    --v-button-background-color-hover: var(--danger-125);\n    --v-button-color: var(--danger-alt);\n    --v-button-color-hover: var(--danger-alt);\n}\n",{}),_.render=function(e,t,n,r,f,v){const y=o("v-icon"),m=o("v-button");return a(),i("div",null,[s(m,{loading:e.isLoading,onClick:e.click,class:l(e.buttonType),secondary:"primary"!==e.buttonType,icon:!e.label},{default:c((()=>[e.icon?(a(),u(y,{key:0,left:"",name:e.icon},null,8,["name"])):d("v-if",!0),p(" "+h(e.label),1)])),_:1},8,["loading","onClick","class","secondary","icon"])])},_.__scopeId="data-v-64969d30",_.__file="src/interface.vue";var U={id:"action-button",name:"Action Button",description:"Send HTTP requests",icon:"smart_button",component:_,hideLabel:!0,hideLoader:!0,types:["alias"],localTypes:["presentation"],group:"presentation",options:({collection:e})=>[{field:"icon",name:"$t:icon",type:"string",meta:{width:"half",interface:"select-icon"}},{field:"buttonType",name:"$t:type",type:"string",meta:{width:"half",interface:"select-dropdown",default_value:"normal",options:{choices:[{text:"$t:primary",value:"primary"},{text:"$t:normal",value:"normal"},{text:"$t:info",value:"info"},{text:"$t:success",value:"success"},{text:"$t:warning",value:"warning"},{text:"$t:danger",value:"danger"}]}},schema:{default_value:"normal"}},{field:"label",type:"full",name:"$t:label",meta:{width:"full",interface:"system-display-template",options:{collectionName:e,font:"monospace",placeholder:"/items/collection/{{ id }}"}}},{field:"method",name:"Method",type:"string",meta:{width:"half",interface:"select-dropdown",options:{choices:[{text:"GET",value:"GET"},{text:"POST",value:"POST"},{text:"PUT",value:"PUT"},{text:"PATCH",value:"PATCH"},{text:"DELETE",value:"DELETE"}]}}},{field:"url",type:"string",name:"$t:url",meta:{width:"full",interface:"system-display-template",options:{collectionName:e,font:"monospace",placeholder:"/items/collection/{{ id }}"}}},{field:"headers",type:"json",name:"Headers",meta:{width:"full",interface:"list",options:{template:"{{ key }}: {{ value }}",fields:[{field:"key",type:"string",name:"$t:name",meta:{interface:"text",width:"full",options:{font:"monospace",placeholder:"Header"}}},{field:"value",type:"string",name:"$t:value",meta:{width:"full",interface:"system-display-template",options:{collectionName:e,font:"monospace"}}}]}}},{field:"body",type:"text",name:"Body",meta:{width:"full",interface:"input-code"}},{field:"result",name:"On success",type:"string",meta:{width:"full",interface:"select-dropdown",default_value:"popup",options:{choices:[{text:"Show popup",value:"popup"},{text:"Go to list",value:"list"}]}},schema:{default_value:"popup"}}]};export{U as default};
